<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mathematical Induction | Mathswell</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
    <link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            startup: {
                ready: () => {
                    window.MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --primary-color: #0f766e;
            --primary-light: #10b981;
            --background: #f7faf9;
            --accent-amber: #f59e0b;
            --accent-red: #c62828;
            --text-primary: #212121;
            --text-muted: #4b5563;
            --container-bg: #ffffff;
            --border-color: #e5e7eb;
            --interactive-bg: #e6fffb;
            --success-color: #10b981;
            --error-color: #ef4444;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--background);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--container-bg);
            min-height: 100vh;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        /* Mathswell Navigation */
        .mathswell-nav {
            display: flex;
            justify-content: center;
            margin: .4rem 0 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .mathswell-nav .mw-link {
            display: inline-flex;
            align-items: center;
            gap: .45rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary-color);
            padding: .3rem .7rem;
            border-radius: 999px;
            background: rgba(255,255,255,.9);
            box-shadow: 0 1px 4px rgba(0,0,0,.08);
        }
        
        .mathswell-nav .mw-link img {
            display: block;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--container-bg);
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        .tab-button:hover:not(.active) {
            background: var(--interactive-bg);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Introduction Styles */
        .intro-section {
            max-width: 800px;
            margin: 0 auto 3rem;
        }

        .concept-explanation {
            background: var(--interactive-bg);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .concept-explanation h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        /* Domino Visualization */
        .domino-chain {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .domino {
            width: 100px;
            height: 110px;
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            padding: 0.4rem;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            transform-origin: bottom center;
            line-height: 1.3;
        }

        .domino:hover {
            transform: translateY(-3px);
            box-shadow: 4px 4px 8px rgba(0,0,0,0.15);
        }

        .domino.falling {
            animation: dominoFall 0.4s ease-out forwards;
        }

        @keyframes dominoFall {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(30deg) translateX(10px);
                background: linear-gradient(145deg, #10b981, #059669);
                border-color: var(--success-color);
                color: white;
            }
        }

        /* Card Visualization */
        .card-chain {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .card {
            width: 110px;
            height: 120px;
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            padding: 0.3rem;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
            line-height: 1.2;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 4px 4px 8px rgba(0,0,0,0.15);
        }

        .card.error {
            background: linear-gradient(145deg, #ff6b6b, #ef4444);
            border-color: var(--error-color);
            color: white;
            animation: turnRed 0.4s ease;
        }

        @keyframes turnRed {
            from {
                background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
                transform: scale(1);
            }
            50% {
                transform: scale(1.1) rotate(-2deg);
            }
            to {
                background: linear-gradient(145deg, #ff6b6b, #ef4444);
                transform: scale(1);
            }
        }

        /* Card Containers */
        .infinite-dominos {
            background: var(--container-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            overflow: hidden;
        }

        .infinite-dominos h4 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }

        .property-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--interactive-bg);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            text-align: left;
        }

        .property-box h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .property-step {
            margin: 0.8rem 0;
            padding: 0.8rem;
            background: white;
            border-radius: 6px;
            border-left: 3px solid var(--primary-light);
        }

        /* Formal Structure */
        .formal-intro {
            background: var(--container-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .formal-intro h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .induction-components {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        @media (max-width: 768px) {
            .induction-components {
                grid-template-columns: 1fr;
            }
        }

        .component-box {
            background: var(--background);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .component-box.base-case {
            border-left: 6px solid var(--success-color);
        }

        .component-box.inductive-step {
            border-left: 6px solid var(--primary-color);
        }

        .component-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
        }

        /* Example Toggle */
        .example-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .toggle-btn {
            padding: 0.8rem 1.5rem;
            background: var(--background);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .toggle-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .toggle-btn:hover:not(.active) {
            border-color: var(--primary-color);
            background: var(--interactive-bg);
        }

        .example-card {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .example-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .proof-display {
            background: var(--interactive-bg);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .proof-step {
            margin-bottom: 0.8rem;
            padding: 0.5rem 0;
            border-left: 3px solid transparent;
            padding-left: 0.8rem;
        }

        .proof-step.base {
            border-left-color: var(--success-color);
        }

        .proof-step.inductive {
            border-left-color: var(--primary-color);
        }

        /* Tree Visualization */
        .tree-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1.5rem 0;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .tree-diagram {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .tree-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .tree-svg {
            width: 150px;
            height: 120px;
        }

        .tree-vertex-small {
            stroke: var(--text-primary);
            stroke-width: 1.5;
        }

        .tree-vertex-small.red {
            fill: #ff6b6b !important;
        }

        .tree-vertex-small.blue {
            fill: #4dabf7 !important;
        }

        .tree-edge {
            stroke: var(--text-primary);
            stroke-width: 2;
        }

        /* AI Practice Section */
        .practice-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--background);
            border-radius: 12px;
        }

        @media (max-width: 768px) {
            .practice-controls {
                grid-template-columns: 1fr;
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .control-group select {
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 1rem;
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .generate-btn {
            grid-column: 1 / -1;
            padding: 1rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            justify-self: center;
            max-width: 300px;
        }

        .generate-btn:hover:not(:disabled) {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        /* Current Problem Display */
        .current-problem {
            background: var(--interactive-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .current-problem h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .statement {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        /* Base Case Practice */
        .base-case-practice {
            background: var(--container-bg);
            border: 2px solid var(--success-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .base-case-practice h5 {
            color: var(--success-color);
            margin-bottom: 1rem;
        }

        .base-case-input {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .base-case-input input {
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            width: 200px;
        }

        .base-case-input input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .base-case-input button {
            padding: 0.8rem 1.5rem;
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .base-case-input button:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        /* Proof Construction */
        .proof-structure {
            max-width: 700px;
            margin: 0 auto;
        }

        .proof-box {
            background: var(--container-bg);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            transition: all 0.3s ease;
        }

        .proof-box.base-box {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .proof-box.if-then-container {
            border-color: var(--primary-color);
            background: rgba(15, 118, 110, 0.05);
        }

        .proof-box.steps-container {
            border-color: var(--border-color);
            background: var(--background);
        }

        .if-then-label {
            text-align: center;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .if-then-boxes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .if-then-boxes {
                grid-template-columns: 1fr;
            }
        }

        .if-box, .then-box {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            min-height: 80px;
        }

        .if-box {
            border-left: 4px solid var(--accent-amber);
        }

        .then-box {
            border-left: 4px solid var(--primary-light);
        }

        .box-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .statement-display {
            font-size: 1.1rem;
            color: var(--text-primary);
            padding: 0.5rem;
            background: var(--interactive-bg);
            border-radius: 6px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sortable-container {
            min-height: 200px;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 2px dashed var(--border-color);
        }

        .proof-step-item {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-left: 5px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .proof-step-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .proof-step-item:active {
            cursor: grabbing;
        }

        .proof-step-item.dragging {
            opacity: 0.5;
        }

        .proof-step-item.correct-position {
            border-left-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        /* Complete Proof Animation */
        .complete-proof {
            background: linear-gradient(135deg, #fff, var(--interactive-bg));
            border: 3px solid var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 8px 32px rgba(15, 118, 110, 0.15);
            animation: mergeAnimation 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .complete-proof::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%);
            animation: shimmer 2s ease-out;
        }

        @keyframes mergeAnimation {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes shimmer {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .complete-proof h5 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.3rem;
            position: relative;
            z-index: 1;
        }

        .complete-proof-content {
            position: relative;
            z-index: 1;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .complete-proof-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        .complete-proof-content strong {
            color: var(--primary-color);
            display: block;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .complete-proof-content .qed {
            text-align: right;
            font-size: 1.2rem;
            margin-top: 1rem;
            color: var(--primary-color);
        }

        /* Proof Controls */
        .proof-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }

        .proof-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .proof-btn.check {
            background: var(--primary-color);
            color: white;
        }

        .proof-btn.check:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .proof-btn.hint {
            background: var(--accent-amber);
            color: white;
        }

        .proof-btn.hint:hover {
            background: #dc8e0a;
            transform: translateY(-2px);
        }

        .proof-btn.reset {
            background: var(--accent-red);
            color: white;
        }

        .proof-btn.reset:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Feedback Display */
        .feedback-display {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .feedback-display.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .feedback-display.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            border: 2px solid var(--error-color);
        }

        .feedback-display.info {
            background: var(--interactive-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .nav-btn {
            padding: 0.8rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        /* Key Insights */
        .key-insights {
            background: var(--container-bg);
            border: 2px solid var(--accent-amber);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .key-insights h4 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .insight-item {
            margin-bottom: 1rem;
            padding-left: 1rem;
            border-left: 3px solid var(--accent-amber);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
        }

        /* Warning Notice */
        .warning-notice {
            background: rgba(251, 191, 36, 0.1);
            color: #92400e;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            border-left: 3px solid var(--accent-amber);
            animation: fadeIn 0.5s ease;
        }

        /* Math content spacing */
        .mjx-chtml {
            margin: 0.2em 0 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="mathswell-nav">
            <a href="https://mathswell.com" class="mw-link">
                <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
                <span>MATHSWELL</span>
            </a>
        </div>

        <div class="header">
            <h1>Mathematical Induction</h1>
            <p class="subtitle">Discover why both base case and inductive step are essential through interactive exploration</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="introduction">Introduction</button>
            <button class="tab-button" data-tab="formal">Formal Structure</button>
            <button class="tab-button" data-tab="practice">AI Practice</button>
        </div>

        <div id="introduction" class="tab-content active">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>What is Mathematical Induction?</h3>
                    <p>Mathematical induction proves statements about infinite sets of numbers by showing two things: the statement is true for the first case, and if it's true for any number, it must be true for the next number. You've been using this reasoning naturally your whole mathematical life - when you extend patterns from small numbers to larger ones.</p>
                </div>

                <div class="infinite-dominos">
                    <h4>Multiplication Property: Building on the Foundation</h4>
                    <p>Click the first domino to see how the pattern extends naturally:</p>
                    
                    <div class="domino-chain" id="multiplication-dominos">
                        <div class="domino" data-n="1" onclick="animateDominos()">
                            $\sqrt{ab}$<br>=<br>$\sqrt{a}\sqrt{b}$
                        </div>
                        <div class="domino" data-n="2">
                            $\sqrt{abc}$<br>=<br>$\sqrt{a}\sqrt{b}\sqrt{c}$
                        </div>
                        <div class="domino" data-n="3">
                            $\sqrt{abcd}$<br>=<br>$\sqrt{a}\sqrt{b}\sqrt{c}\sqrt{d}$
                        </div>
                        <div class="domino" data-n="4">
                            $\sqrt{abcde}$<br>=<br>$\sqrt{a}\sqrt{b}\sqrt{c}\sqrt{d}\sqrt{e}$
                        </div>
                        <div class="domino" data-n="5">
                            â‹¯
                        </div>
                        <div class="domino" data-n="6">
                            â‹¯
                        </div>
                    </div>
                    
                    <div id="multiplication-property" class="property-box">
                        <h5>How the Pattern Extends</h5>
                        <div class="property-step">
                            <strong>From 2 to 3 terms:</strong> $\sqrt{abc} = \sqrt{(ab) \cdot c} = \sqrt{ab} \cdot \sqrt{c} = \sqrt{a} \cdot \sqrt{b} \cdot \sqrt{c}$
                        </div>
                        <div class="property-step">
                            <strong>From 3 to 4 terms:</strong> $\sqrt{abcd} = \sqrt{(abc) \cdot d} = \sqrt{abc} \cdot \sqrt{d} = \sqrt{a} \cdot \sqrt{b} \cdot \sqrt{c} \cdot \sqrt{d}$
                        </div>
                        <div class="property-step">
                            <em>This pattern extends naturally because multiplication is associative!</em>
                        </div>
                    </div>
                </div>

                <div class="infinite-dominos" style="margin-top: 3rem;">
                    <h4>Addition Property: Testing the Pattern</h4>
                    <p>Click the first card to test if this equality actually holds:</p>
                    
                    <div class="card-chain" id="addition-cards">
                        <div class="card" data-n="1" onclick="animateAdditionCard(1)">
                            $\sqrt{a+b}$<br>=?<br>$\sqrt{a}+\sqrt{b}$
                        </div>
                        <div class="card" data-n="2">
                            $\sqrt{a+b+c}$<br>=?<br>$\sqrt{a}+\sqrt{b}+\sqrt{c}$
                        </div>
                        <div class="card" data-n="3">
                            $\sqrt{a+b+c+d}$<br>=?<br>$\sqrt{a}+\sqrt{b}+\sqrt{c}+\sqrt{d}$
                        </div>
                    </div>
                    
                    <div id="addition-property" class="property-box" style="display: none;">
                        <h5 style="color: var(--error-color);">Why This Fails</h5>
                        <div class="property-step" style="border-left-color: var(--error-color);">
                            <strong>Testing the claimed equality:</strong> $\sqrt{4+9} = \sqrt{13} \approx 3.6$ but $\sqrt{4} + \sqrt{9} = 2 + 3 = 5$ âœ—
                        </div>
                        <div class="property-step" style="border-left-color: var(--error-color);">
                            <strong>The foundation is false!</strong> Since $\sqrt{a+b} \neq \sqrt{a} + \sqrt{b}$, the claimed pattern doesn't hold.
                        </div>
                    </div>
                </div>

                <div class="key-insights">
                    <h4>The Trap Revealed</h4>
                    <div class="insight-item">
                        <div class="insight-title">Natural Pattern Extension:</div>
                        <div>You naturally extend $\sqrt{ab} = \sqrt{a} \cdot \sqrt{b}$ to more terms. The same reasoning seems to apply to addition - "if the pattern works for n terms, it works for n+1 terms."</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">The Missing Foundation:</div>
                        <div>The inductive step alone isn't enough! You use your current assumption to prove the next case, so you must be absolutely certain about your starting point. Just one failed calculation breaks the entire infinite chain.</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="switchTab('formal')">Learn Formal Structure â†’</button>
                    <button class="nav-btn" onclick="switchTab('practice')">Try AI Practice â†’</button>
                </div>
            </div>
        </div>

        <div id="formal" class="tab-content">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>The Two-Part Structure of Mathematical Induction</h3>
                    <p>Mathematical induction requires both components to work. Like our square root examples showed, the inductive step alone can mislead you into accepting false statements.</p>
                </div>

                <div class="formal-intro">
                    <h4>Mathematical Induction Framework</h4>
                    <p>To prove a statement P(n) for all integers n â‰¥ nâ‚€:</p>
                    
                    <div class="induction-components">
                        <div class="component-box base-case">
                            <div class="component-title">Base Case</div>
                            <p>Prove P(nâ‚€) is true</p>
                            <p><em>Verify the statement for the starting value</em></p>
                        </div>
                        
                        <div class="component-box inductive-step">
                            <div class="component-title">Inductive Step</div>
                            <p>Assume P(k) is true, then prove P(k+1) is true</p>
                            <p><em>Show: if the pattern holds for k, then it holds for k+1</em></p>
                        </div>
                    </div>
                    
                    <p><strong>Conclusion:</strong> P(n) is true for all integers n â‰¥ nâ‚€</p>
                </div>

                <div class="example-toggle">
                    <button class="toggle-btn active" onclick="showExample('sum')" id="sum-toggle">Sum Formula Example</button>
                    <button class="toggle-btn" onclick="showExample('tree')" id="tree-toggle">Tree Coloring Example</button>
                </div>

                <div id="sum-example" class="example-card">
                    <h4>Proof: Sum of First n Odd Numbers</h4>
                    <p><strong>Statement:</strong> $1 + 3 + 5 + ... + (2n-1) = n^2$ for all positive integers n</p>
                    
                    <div class="proof-display">
                        <div class="proof-step base">
                            <strong>Base Case (n = 1):</strong><br>
                            Left side: 1<br>
                            Right side: $1^2 = 1$ âœ“
                        </div>
                        
                        <div class="proof-step inductive">
                            <strong>Inductive Step:</strong><br>
                            Assume: $1 + 3 + 5 + ... + (2k-1) = k^2$<br>
                            Prove: $1 + 3 + 5 + ... + (2k-1) + (2(k+1)-1) = (k+1)^2$<br><br>
                            Left side = $k^2 + (2k+1)$ (by assumption)<br>
                            = $k^2 + 2k + 1 = (k+1)^2$ âœ“
                        </div>
                        
                        <div class="proof-step">
                            <strong>Conclusion:</strong> The formula holds for all positive integers n
                        </div>
                    </div>
                </div>

                <div id="tree-example" class="example-card" style="display: none;">
                    <h4>Proof: Every Tree Can Be 2-Colored</h4>
                    <p><strong>Statement:</strong> Every tree with n vertices can be colored with just 2 colors so that adjacent vertices have different colors</p>
                    
                    <div class="tree-visual">
                        <div class="tree-diagram">
                            <div class="tree-title">1 vertex</div>
                            <svg class="tree-svg" viewBox="0 0 150 120">
                                <circle class="tree-vertex-small red" cx="75" cy="60" r="10"/>
                            </svg>
                        </div>
                        
                        <div class="tree-diagram">
                            <div class="tree-title">2 vertices</div>
                            <svg class="tree-svg" viewBox="0 0 150 120">
                                <line class="tree-edge" x1="55" y1="60" x2="95" y2="60"/>
                                <circle class="tree-vertex-small red" cx="55" cy="60" r="10"/>
                                <circle class="tree-vertex-small blue" cx="95" cy="60" r="10"/>
                            </svg>
                        </div>
                        
                        <div class="tree-diagram">
                            <div class="tree-title">3 vertices</div>
                            <svg class="tree-svg" viewBox="0 0 150 120">
                                <line class="tree-edge" x1="75" y1="40" x2="55" y2="80"/>
                                <line class="tree-edge" x1="75" y1="40" x2="95" y2="80"/>
                                <circle class="tree-vertex-small red" cx="75" cy="40" r="10"/>
                                <circle class="tree-vertex-small blue" cx="55" cy="80" r="10"/>
                                <circle class="tree-vertex-small blue" cx="95" cy="80" r="10"/>
                            </svg>
                        </div>
                        
                        <div class="tree-diagram">
                            <div class="tree-title">4 vertices</div>
                            <svg class="tree-svg" viewBox="0 0 150 120">
                                <line class="tree-edge" x1="75" y1="30" x2="75" y2="60"/>
                                <line class="tree-edge" x1="75" y1="60" x2="55" y2="90"/>
                                <line class="tree-edge" x1="75" y1="60" x2="95" y2="90"/>
                                <circle class="tree-vertex-small red" cx="75" cy="30" r="10"/>
                                <circle class="tree-vertex-small blue" cx="75" cy="60" r="10"/>
                                <circle class="tree-vertex-small red" cx="55" cy="90" r="10"/>
                                <circle class="tree-vertex-small red" cx="95" cy="90" r="10"/>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="proof-display">
                        <div class="proof-step base">
                            <strong>Base Case (1 vertex):</strong><br>
                            A single vertex can be colored with one color (trivially 2-colorable) âœ“
                        </div>
                        
                        <div class="proof-step inductive">
                            <strong>Inductive Step:</strong><br>
                            Assume: Any tree with k vertices can be 2-colored<br>
                            Prove: Any tree with k+1 vertices can be 2-colored<br><br>
                            Take any tree T with k+1 vertices. Find any vertex that is connected to exactly one other vertex.<br>
                            Remove this vertex - the remaining tree has k vertices, so by assumption it's 2-colorable.<br>
                            Color the removed vertex with the opposite color of its single neighbor âœ“
                        </div>
                        
                        <div class="proof-step">
                            <strong>Conclusion:</strong> Every tree can be 2-colored
                        </div>
                    </div>
                </div>

                <div class="key-insights">
                    <h4>Why Both Parts Matter</h4>
                    <div class="insight-item">
                        <div class="insight-title">Base Case:</div>
                        <div>Ensures your pattern actually starts correctly. You use this foundation to prove the next case, so you must be absolutely certain about it. Many false statements have valid inductive steps but fail at this crucial starting point.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Inductive Step:</div>
                        <div>Ensures the pattern continues consistently. Shows that truth propagates from each case to the next.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Together:</div>
                        <div>They create an unbroken chain of truth from the base case to any finite case you want to reach.</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="switchTab('practice')">Practice with AI â†’</button>
                </div>
            </div>
        </div>

        <div id="practice" class="tab-content">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>Interactive Proof Construction</h3>
                    <p>Generate custom induction problems with AI assistance. First identify the base case, then arrange the individual sentences of the proof in logical order.</p>
                    <p style="font-size: 0.9rem; font-style: italic; color: var(--text-muted); margin-top: 1rem; opacity: 0.9;">
                        <strong>Note:</strong> The AI helper can make mistakes and may be temporarily unavailable during high traffic periods.
                    </p>
                </div>

                <div class="practice-controls">
                    <div class="control-group">
                        <label for="statement-type">Statement Type</label>
                        <select id="statement-type">
                            <option value="sum-formula">Sum Formula</option>
                            <option value="inequality">Inequality</option>
                            <option value="divisibility">Divisibility</option>
                            <option value="sequence">Sequence Property</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="difficulty">Difficulty</label>
                        <select id="difficulty">
                            <option value="basic">Basic</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                    <button class="generate-btn" id="generate-problem" onclick="generateProblem()">
                        Generate Problem with AI
                    </button>
                </div>

                <div id="current-problem" class="current-problem" style="display: none;">
                    <h4>Current Problem</h4>
                    <div class="statement" id="statement-display"></div>
                    
                    <div class="base-case-practice">
                        <h5>Step 1: Identify the Base Case</h5>
                        <p>What is the smallest value of n for which this statement should be true?</p>
                        <div class="base-case-input">
                            <input type="text" id="base-case-input" placeholder="Enter base case value (e.g., n = 1)">
                            <button id="check-base-case" onclick="checkBaseCase()">Check Base Case</button>
                        </div>
                        <div id="base-case-feedback" class="feedback-display" style="display: none;"></div>
                    </div>

                    <div id="proof-construction" class="proof-construction" style="display: none;">
                        <h5>Step 2: Build the Induction Proof</h5>
                        <p>The proof structure is shown below. Arrange the proof steps in the correct order:</p>
                        
                        <div class="proof-structure">
                            <div class="proof-box base-box">
                                <div class="box-label">Base Case Verification</div>
                                <div class="statement-display" id="base-statement"></div>
                            </div>

                            <div class="proof-box if-then-container">
                                <div class="if-then-label">Inductive Step</div>
                                <div class="if-then-boxes">
                                    <div class="if-box">
                                        <div class="box-label">Assume P(k):</div>
                                        <div class="statement-display" id="pk-statement"></div>
                                    </div>
                                    <div class="then-box">
                                        <div class="box-label">Prove P(k+1):</div>
                                        <div class="statement-display" id="pk1-statement"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="proof-box steps-container">
                                <div class="box-label">Proof Steps (arrange in correct order)</div>
                                <div class="sortable-container" id="proof-steps-container"></div>
                            </div>
                        </div>

                        <div class="proof-controls">
                            <button class="proof-btn hint" onclick="showProofHint()">ðŸ’¡ Hint</button>
                            <button class="proof-btn check" onclick="checkProofStructure()">âœ… Check Proof</button>
                            <button class="proof-btn reset" onclick="resetProofStructure()">ðŸ”„ Reset</button>
                        </div>

                        <div class="complete-proof" id="complete-proof" style="display: none;">
                            <h5>âœ¨ Complete Proof by Mathematical Induction</h5>
                            <div id="complete-proof-content" class="complete-proof-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let state = {
            currentProblem: null,
            draggedElement: null,
        };

        // Fallback problems when AI is unavailable
        const fallbackProblems = {
            'sum-formula-basic': {
                statement: "For all integers $n \\ge 1$: $1 + 3 + 5 + ... + (2n-1) = n^2$",
                baseCase: "n = 1",
                baseValue: 1,
                hint: "For the inductive step, try to isolate the expression for P(k) on the left side of P(k+1).",
                baseCaseVerification: "For $n=1$, the statement is $1 = 1^2$, which is true.",
                p_k: "$1 + 3 + 5 + ... + (2k-1) = k^2$",
                p_k_plus_1: "$1 + 3 + 5 + ... + (2(k+1)-1) = (k+1)^2$",
                proofSteps: [
                    "Assume the statement is true for some integer $k \\ge 1$.",
                    "Consider the left-hand side (LHS) for $n=k+1$: $1 + 3 + ... + (2k-1) + (2(k+1)-1)$.",
                    "Using the inductive hypothesis, we can substitute $k^2$ for the sum up to $(2k-1)$.",
                    "The expression becomes $k^2 + (2(k+1)-1)$.",
                    "Simplifying this gives $k^2 + 2k + 1$.",
                    "This expression factors to $(k+1)^2$, which is the right-hand side (RHS) for $n=k+1$.",
                    "Thus, the statement holds for $n=k+1$.",
                    "By the principle of mathematical induction, the statement is true for all $n \\ge 1$. âˆŽ"
                ]
            },
            'inequality-basic': {
                statement: "For all integers $n \\ge 1$: $2^n > n$",
                baseCase: "n = 1",
                baseValue: 1,
                hint: "After applying the inductive hypothesis, you'll have $2^{k+1} > 2k$. How can you show that $2k \\ge k+1$?",
                baseCaseVerification: "For $n=1$, the statement is $2^1 > 1$, or $2 > 1$, which is true.",
                p_k: "$2^k > k$",
                p_k_plus_1: "$2^{k+1} > k+1$",
                proofSteps: [
                    "Assume the statement is true for some integer $k \\ge 1$, so $2^k > k$.",
                    "Consider the case for $n=k+1$: we want to show $2^{k+1} > k+1$.",
                    "Start with the left-hand side: $2^{k+1} = 2 \\cdot 2^k$.",
                    "By the inductive hypothesis, since $2^k > k$, we have $2 \\cdot 2^k > 2k$.",
                    "For $k \\ge 1$, we know that $2k = k+k \\ge k+1$.",
                    "Combining these inequalities, we get $2^{k+1} > 2k \\ge k+1$.",
                    "Therefore, $2^{k+1} > k+1$.",
                    "By the principle of mathematical induction, the statement is true for all $n \\ge 1$. âˆŽ"
                ]
            }
        };

        // DOM references
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // Initialize
        function init() {
            setupTabs();
            
            // Typeset initial math
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        }

        // Tab switching
        function setupTabs() {
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }

        function switchTab(tabId) {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Show domino falling animation - always starts from first domino
        function animateDominos() {
            const chain = document.getElementById('multiplication-dominos');
            
            // Reset all dominos
            chain.querySelectorAll('.domino').forEach(d => {
                d.classList.remove('falling');
            });
            
            // Make all dominos fall one after another starting from the first
            for (let i = 1; i <= 6; i++) {
                const domino = chain.querySelector(`[data-n="${i}"]`);
                if (domino) {
                    setTimeout(() => {
                        domino.classList.add('falling');
                    }, (i - 1) * 150);
                }
            }
            
            // Typeset math
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        }

        // Show addition card turning red
        function animateAdditionCard(n) {
            const chain = document.getElementById('addition-cards');
            const propertyBox = document.getElementById('addition-property');
            
            if (n === 1) {
                const card = chain.querySelector(`[data-n="1"]`);
                card.classList.add('error');
                propertyBox.style.display = 'block';
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([propertyBox]);
                }
            }
        }

        // Example toggle in formal tab
        function showExample(type) {
            const sumBtn = document.getElementById('sum-toggle');
            const treeBtn = document.getElementById('tree-toggle');
            const sumExample = document.getElementById('sum-example');
            const treeExample = document.getElementById('tree-example');
            
            if (type === 'sum') {
                sumBtn.classList.add('active');
                treeBtn.classList.remove('active');
                sumExample.style.display = 'block';
                treeExample.style.display = 'none';
            } else {
                treeBtn.classList.add('active');
                sumBtn.classList.remove('active');
                treeExample.style.display = 'block';
                sumExample.style.display = 'none';
            }
            
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([document.querySelector('#formal .intro-section')]);
            }
        }

        // Fixed AI integration - matching the working if-then app structure
        async function callAI(prompt, retries = 2) {
            for (let i = 0; i <= retries; i++) {
                try {
                    if (i > 0) {
                        await new Promise(r => setTimeout(r, Math.pow(2, i-1) * 1000));
                    }
                    
                    const response = await fetch('/api/gemini', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ role: "user", parts: [{ text: prompt }] }] 
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!text) {
                        throw new Error('Empty response from AI');
                    }
                    
                    return text;
                    
                } catch (error) {
                    console.error(`AI attempt ${i+1} failed:`, error);
                    if (i === retries) {
                        throw error;
                    }
                }
            }
        }

        function extractJSON(text) {
            let data;
            
            try {
                data = JSON.parse(text);
            } catch {
                // Try to find JSON in the response
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('No JSON found in response');
                }
                
                const cleaned = jsonMatch[0]
                    .replace(/```json\s*/g, '')
                    .replace(/```\s*/g, '')
                    .trim();
                
                try {
                    data = JSON.parse(cleaned);
                } catch (e) {
                    throw new Error('Invalid JSON format');
                }
            }
            
            // Validate required fields
            const required = ['statement', 'baseCase', 'baseValue', 'baseCaseVerification', 'p_k', 'p_k_plus_1', 'proofSteps'];
            for (const field of required) {
                if (!(field in data)) {
                    throw new Error(`Missing required field: ${field}`);
                }
            }
            
            // Ensure proofSteps is an array
            if (!Array.isArray(data.proofSteps)) {
                throw new Error('proofSteps must be an array');
            }
            
            return data;
        }

        async function generateProblem() {
            const statementType = document.getElementById('statement-type').value;
            const difficulty = document.getElementById('difficulty').value;
            const generateBtn = document.getElementById('generate-problem');
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            
            document.getElementById('current-problem').style.display = 'block';
            document.getElementById('statement-display').innerHTML = 'Generating a new induction problem...';
            
            // Clear any old warnings
            document.querySelectorAll('.warning-notice').forEach(n => n.remove());
            
            const prompt = `
                Generate a mathematical induction problem.
                - Type: ${statementType}
                - Difficulty: ${difficulty}

                Return ONLY a single valid JSON object with the following structure:
                {
                  "statement": "The full statement to be proven, using LaTeX, like 'For all integers $n \\ge 1$: ...'",
                  "baseCase": "A short string for the base case, like 'n = 1'",
                  "baseValue": 1,
                  "hint": "A short, helpful hint for the proof.",
                  "baseCaseVerification": "A single sentence that shows the base case is true, using LaTeX. Example: 'For $n=1$, the statement is $2^1 > 1$, which is true.'",
                  "p_k": "The mathematical expression for P(k), using LaTeX. Example: '$2^k > k$'.",
                  "p_k_plus_1": "The mathematical expression for P(k+1), using LaTeX. Example: '$2^{k+1} > k+1$'.",
                  "proofSteps": [
                    "An array of strings, where each string is a single sentence in the logical flow of the inductive step proof.",
                    "The proof should start with the assumption and end with the conclusion.",
                    "Use LaTeX for all math.",
                    "Example Step: 'By the inductive hypothesis, we can substitute $k^2$ for the grouped sum.'"
                  ]
                }
                
                IMPORTANT: Return ONLY the JSON object, no markdown formatting, no explanations.
            `;
            
            try {
                const response = await callAI(prompt, 2);
                state.currentProblem = extractJSON(response);
                
                document.getElementById('statement-display').innerHTML = state.currentProblem.statement;
                document.getElementById('base-case-input').value = '';
                document.getElementById('base-case-feedback').style.display = 'none';
                document.getElementById('proof-construction').style.display = 'none';
                
            } catch (error) {
                console.error('AI generation failed:', error);
                
                const fallbackKey = `${statementType}-basic`; // Simplified fallback key
                state.currentProblem = fallbackProblems[fallbackKey] || fallbackProblems['sum-formula-basic'];
                
                document.getElementById('statement-display').innerHTML = state.currentProblem.statement;
                
                // Show warning notice
                const warning = document.createElement('div');
                warning.className = 'warning-notice';
                warning.innerHTML = 'âš ï¸ Using backup problem (AI temporarily unavailable)';
                const problemContainer = document.getElementById('current-problem');
                problemContainer.insertBefore(warning, problemContainer.firstChild);

                setTimeout(() => { if (warning) warning.remove(); }, 5000);
            }
            
            generateBtn.disabled = false;
            generateBtn.textContent = 'Generate Problem with AI';
            
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([document.getElementById('statement-display')]);
            }
        }

        function checkBaseCase() {
            if (!state.currentProblem) {
                alert('Please generate a problem first!');
                return;
            }
            
            const userInput = document.getElementById('base-case-input').value.trim().toLowerCase();
            const correctValue = state.currentProblem.baseValue;
            const feedbackDiv = document.getElementById('base-case-feedback');
            
            feedbackDiv.style.display = 'block';
            
            const hasCorrectValue = userInput.includes(correctValue.toString()) || 
                                    userInput.includes(`n = ${correctValue}`) || 
                                    userInput.includes(`n=${correctValue}`);
            
            if (hasCorrectValue) {
                feedbackDiv.className = 'feedback-display success';
                feedbackDiv.innerHTML = `
                    <strong>Correct!</strong><br>
                    Base case: ${state.currentProblem.baseCase}<br>
                    Now let's construct the complete proof!
                `;
                document.getElementById('proof-construction').style.display = 'block';
                populateProofSteps();
            } else {
                feedbackDiv.className = 'feedback-display info';
                const userValue = parseInt(userInput.match(/-?\d+/)?.[0]);
                
                if (isNaN(userValue)) {
                    feedbackDiv.innerHTML = `
                        <strong>Hint:</strong><br>
                        Look for the smallest integer where the statement holds. Try n = 0, n = 1, etc.
                    `;
                } else if (userValue < correctValue) {
                    feedbackDiv.innerHTML = `
                        <strong>Too small!</strong><br>
                        The statement might not hold for n = ${userValue}. Try a larger value.
                    `;
                } else if (userValue > correctValue) {
                    feedbackDiv.innerHTML = `
                        <strong>Correct, but not the base case!</strong><br>
                        While the statement is true for n = ${userValue}, we need the smallest value.
                    `;
                }
            }
        }

        function populateProofSteps() {
            if (!state.currentProblem) return;

            document.getElementById('base-statement').innerHTML = state.currentProblem.baseCaseVerification;
            document.getElementById('pk-statement').innerHTML = state.currentProblem.p_k;
            document.getElementById('pk1-statement').innerHTML = state.currentProblem.p_k_plus_1;

            const container = document.getElementById('proof-steps-container');
            container.innerHTML = '';

            const proofStepItems = state.currentProblem.proofSteps.map((step, index) => {
                return { content: step, order: index };
            });

            const shuffledSteps = [...proofStepItems].sort(() => Math.random() - 0.5);

            shuffledSteps.forEach((item, index) => {
                const stepEl = document.createElement('div');
                stepEl.className = 'proof-step-item';
                stepEl.draggable = true;
                stepEl.innerHTML = item.content;
                stepEl.setAttribute('data-order', item.order);
                stepEl.setAttribute('data-id', `step-${index}`);
                container.appendChild(stepEl);
            });
            
            document.getElementById('complete-proof').style.display = 'none';
            setupSortable();
            
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([document.getElementById('proof-construction')]);
            }
        }

        function setupSortable() {
            const container = document.getElementById('proof-steps-container');
            
            container.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('proof-step-item')) {
                    state.draggedElement = e.target;
                    e.target.classList.add('dragging');
                }
            });
            
            container.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('proof-step-item')) {
                    e.target.classList.remove('dragging');
                }
            });
            
            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                
                if (afterElement == null) {
                    container.appendChild(state.draggedElement);
                } else {
                    container.insertBefore(state.draggedElement, afterElement);
                }
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.proof-step-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function checkProofStructure() {
            const container = document.getElementById('proof-steps-container');
            const steps = container.querySelectorAll('.proof-step-item');
            
            let isCorrect = true;
            steps.forEach((step, index) => {
                const expectedOrder = parseInt(step.getAttribute('data-order'));
                if (expectedOrder !== index) {
                    isCorrect = false;
                    step.classList.remove('correct-position');
                } else {
                    step.classList.add('correct-position');
                }
            });
            
            if (isCorrect) {
                showCompleteProof();
            } else {
                alert('Not quite right! Check the logical flow. Correctly placed steps are highlighted in green.');
            }
        }

        function showCompleteProof() {
            const completeProof = document.getElementById('complete-proof');
            const content = document.getElementById('complete-proof-content');
            
            document.querySelectorAll('.proof-box').forEach(box => {
                box.style.transition = 'opacity 0.5s, transform 0.5s';
                box.style.opacity = '0.3';
                box.style.transform = 'scale(0.98)';
            });
            
            const { statement, baseValue, baseCaseVerification, p_k, p_k_plus_1, proofSteps } = state.currentProblem;
            const proofParagraphs = proofSteps.map(step => `<p>${step}</p>`).join('');

            content.innerHTML = `
                <p><strong>Proof by Mathematical Induction:</strong></p>
                <p>We will prove that ${statement.replace(/For all integers.*?:/, '').trim()}.</p>
                
                <strong>Base Case (n = ${baseValue}):</strong>
                <p>${baseCaseVerification}</p>
                
                <strong>Inductive Step:</strong>
                <p>Assume the statement holds for some integer $k \\ge ${baseValue}. That is, we assume:</p>
                <p style="text-align:center;">${p_k}</p>
                <p>We must now show that the statement holds for $n = k+1$. That is, we must prove:</p>
                <p style="text-align:center;">${p_k_plus_1}</p>
                
                ${proofParagraphs}
                
                <div class="qed">âˆŽ</div>
            `;
            
            completeProof.style.display = 'block';
            completeProof.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([content]);
            }
        }

        function resetProofStructure() {
            document.querySelectorAll('.proof-box').forEach(box => {
                box.style.opacity = '1';
                box.style.transform = 'scale(1)';
            });
            
            populateProofSteps();
        }

        function showProofHint() {
            if (!state.currentProblem) {
                alert('Please generate a problem first!');
                return;
            }
            
            const hints = [
                "The proof should always begin by stating the assumption (the inductive hypothesis).",
                "After the assumption, clearly state what you intend to prove for the k+1 case.",
                "Start with the more complex side of the P(k+1) equation and try to simplify it.",
                "Look for a way to use the P(k) assumption. You almost always substitute it into the P(k+1) expression.",
                "The next steps usually involve algebraic simplification.",
                "Keep manipulating the expression until it matches the other side of the P(k+1) equation.",
                "Your second to last step should explicitly show that the LHS equals the RHS of P(k+1).",
                "The final step is always the concluding sentence based on the principle of induction."
            ];
            
            const container = document.getElementById('proof-steps-container');
            const steps = container.querySelectorAll('.proof-step-item');
            let firstWrong = -1;
            
            steps.forEach((step, index) => {
                const expectedOrder = parseInt(step.getAttribute('data-order'));
                if (expectedOrder !== index && firstWrong === -1) {
                    firstWrong = index;
                }
            });
            
            if (firstWrong >= 0 && firstWrong < hints.length) {
                alert(hints[firstWrong]);
            } else {
                alert(`Remember: ${state.currentProblem.hint}`);
            }
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
